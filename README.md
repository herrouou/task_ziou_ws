# Task_Ziou

This is a workspace of the task done by Ziou. It contains a ROS2 workspace which has 2 packages.


## Prerequisites

### 1.1 Ubuntu and ROS

Ubuntu 64-bit 22.04. [ROS Humble](https://docs.ros.org/en/humble/Installation.html).

### 1.2 Extra packages

These are the extra packages to run the program:

```
sudo apt-get update
sudo apt-get install libcanberra-gtk-module
sudo apt-get install libcanberra-gtk3-module
sudo apt-get install ros-humble-plotjuggler-ros
sudo apt-get install ros-humble-generate-parameter-library
sudo apt-get install ros-humble-cv-bridge
sudo apt-get install python3-colcon-common-extensions
```

Some code formatting and linting tools:

```
sudo apt-get install clang-format
sudo apt-get install python3-autopep8
sudo apt-get install python3-ament-pycodestyle
```

## Compile

Firstly, clone the repository and go into the workspace:

```
git clone https://github.com/herrouou/task_ws.git
cd task_ws
```

**Build and Test**

The `build_and_test.sh` run the both the build and test(for all packages and test files):

```
. build_and_test.sh
```

If you want to execute build and test separately, please follow:

**Build**:

```
source /opt/ros/humble/setup.bash
unset GTK_PATH
colcon build
```

and source the setup.bash file:

```
source install/setup.bash
```

**Test**:

Run the test for C++ version sine_wave_cpp:
```
colcon test --packages-select sine_wave_cpp
```
Run the test for Python version sine_wave_python:
```
colcon test --packages-select sine_wave_py
```

To see the test result, run:
```
colcon test-result --verbose
```

## Run the package

The logic and the structure of both C++ and Python versions are similar:

1. There are 2 nodes: `sine_wave_publisher_node` and `sine_wave_receiver_node`. 

2. The `sine_wave_publisher_node` uses the dynamic parameters generated by `generate_parameter_library` to generate a sine wave and publish the `sine_wave` message. The message is a custom message which contain time stamp and the value
  
3. The `sine_wave_receiver_node` also receieves the dynamic parameters generated by `generate_parameter_library`. And it can subscribe the `sine_wave` messages published by `sine_wave_publisher_node` and log the sine wave value on terminal. Additionally, it also create a image converting service, which can recieve the request (the file path of the image) of a client and response with a gray scaled image.

4. Parameters of sine_wave:

```
  publisher_frequency
  amplitude
  angular_frequency
  phase
```

5. We use the PlotJuggler to visualize the sine wave and use CV windows to visualize the origin image and gray scaled image.

### 1. Launch the Publisher and Receiver

**using C++ package(C++ Version)**

The package name is sine_wave_cpp, and run the launch file:

```
ros2 launch sine_wave_cpp sine_wave_cpp.launch.py
```

**using Python Version(Python Version)**

The package name is sine_wave_py, and run the launch file:

```
ros2 launch sine_wave_py sine_wave_py.launch.py
```

### 2. Visualize sine wave and dynamically tune the parameters

To tune the parameters, for example change the amplitude(default value is 1.0), open another terminal and run:

```
ros2 param set /sine_wave_publisher amplitude 5.0
```

And you can see the amplitude changing in PlotJuggler.

### 3. Call the service and visualize images

A image is saved in `src/sine_wave_cpp/pics`. To call the service, open another terminal and run:

```
ros2 service call /convert_image sine_wave_cpp/srv/ConvertImage "{file_path: 'src/sine_wave_cpp/pics/image.png'}" > /dev/null 2>&1
```
To quit the visualization-window, please tap 'Enter' or other keys on the window
